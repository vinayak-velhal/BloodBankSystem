@model BloodBankManagementSystem.Models.DonorRecord

@{
    ViewData["Title"] = "Edit";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-11">

            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-header bg-primary text-white text-center py-3 rounded-top-4">
                    <h4 class="mb-0"><img src="~/icons/Donor.png" alt="Donor Icon" width="40" height="40" class="mb-1 me-1" /> Edit Donor</h4>
                </div>

                <div class="card-body px-4 py-4">
                    <form asp-action="Edit" method="post" class="needs-validation" novalidate> 
                         @Html.AntiForgeryToken()
                        <input type="hidden" asp-for="Id" />
                
                            <!-- Tabs Navigation -->
                        <ul class="nav nav-pills mb-4 justify-content-center" role="tablist">
                            <li class="nav-item"><a class="nav-link active" data-bs-toggle="pill" href="#info"><i class="bi bi-person-lines-fill me-1"></i> Donor Info</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="pill" href="#replacement"><i class="bi bi-arrow-repeat me-1"></i> Replacement</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="pill" href="#medical"><i class="bi bi-clipboard2-pulse me-1"></i> Questionnaire</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="pill" href="#female"><i class="bi bi-gender-female me-1"></i> Women Donor</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="pill" href="#physical"><i class="bi bi-heart-pulse me-1"></i> Checkup</a></li>
                        </ul>

                        <div class="tab-content">
                                <div id="info" class="tab-pane fade show active">
                                <h5 class="text-primary mb-3 fw-semibold">Donor Basic Information</h5>
                                <hr />
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label asp-for="FullName" class="form-label fw-semibold"></label>
                                        <input asp-for="FullName" class="form-control shadow-sm" />
                                        <span asp-validation-for="FullName" class="text-danger small"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="RelativeName" class="form-label fw-semibold"></label>
                                        <input asp-for="RelativeName" class="form-control shadow-sm" />
                                        <span asp-validation-for="RelativeName" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="DateOfBirth" class="form-label fw-semibold"></label>
                                        <input asp-for="DateOfBirth" type="date" class="form-control shadow-sm" />
                                        <span asp-validation-for="DateOfBirth" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="Gender" class="form-label fw-semibold"></label>
                                        <select asp-for="Gender" id="gender" class="form-select shadow-sm">
                                            <option value="">Select Gender</option>
                                            <option>Male</option>
                                            <option>Female</option>
                                        </select>
                                        <span asp-validation-for="Gender" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="Occupation" class="form-label fw-semibold"></label>
                                        <input asp-for="Occupation" class="form-control shadow-sm" />
                                        <span asp-validation-for="Occupation" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="MobileNumber" class="form-label fw-semibold"></label>
                                        <input asp-for="MobileNumber" class="form-control shadow-sm" />
                                        <span asp-validation-for="MobileNumber" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="Address" class="form-label fw-semibold"></label>
                                        <input asp-for="Address" class="form-control shadow-sm" />
                                        <span asp-validation-for="Address" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="BloodGroup" class="form-label fw-semibold"></label>
                                        <select asp-for="BloodGroup" asp-items="(SelectList)ViewBag.BloodGroups" class="form-select shadow-sm">
                                            <option value="">--Select Blood Group--</option>
                                        </select>
                                        <span asp-validation-for="BloodGroup" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="DonationType" class="form-label fw-semibold">Donation Type</label><br />
                                        <div class="form-check form-check-inline">
                                            <input type="radio" id="donorType" asp-for="DonationType" value="Voluntary" class="form-check-input" />
                                            <label class="form-check-label">Voluntary</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input type="radio" id="donorType" asp-for="DonationType" value="Replacement" class="form-check-input" />
                                            <label class="form-check-label">Replacement</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="DoctorId" class="form-label fw-semibold"></label>
                                        <select asp-for="DoctorId" class="form-select shadow-sm" asp-items="@(new SelectList(ViewBag.DoctorList, "DoctorId", "DoctorName"))">
                                            <option value="">-- Select Doctor --</option>
                                        </select>
                                        <span asp-validation-for="DoctorId" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="DonationDate" class="form-label fw-semibold"></label>
                                        <input asp-for="DonationDate" type="date" class="form-control shadow-sm" />
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="LastDonationDate" class="form-label fw-semibold"></label>
                                        <input asp-for="LastDonationDate" type="date" class="form-control shadow-sm" />
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="Quantity" class="form-label fw-semibold">Quantity (in ml)</label>                               
                                        <input asp-for="Quantity" class="form-control shadow-sm" placeholder="Enter quantity (ml)" />
                                        <span asp-validation-for="Quantity" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                                <div id="replacement" class="tab-pane fade">
                                <h5 class="text-primary mb-3 fw-semibold">Replacement Donor Details</h5>
                                <hr />
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">Patient Name</label>
                                        <select asp-for="PatientId" id="PatientDropdown" class="form-select shadow-sm">
                                            <option value="">-- Select Patient Name --</option>
                                              @foreach (var p in (IEnumerable<dynamic>)ViewBag.PatientList)
                                              {
                                                <option value="@p.PatientId">@p.Display</option>
                                              }
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">Hospital Name</label>
                                        <input id="HospitalName" class="form-control shadow-sm" value="@Model.PatientRecord?.HospitalName" readonly />
                                     </div>                                
                                    <div class="col-md-6">
                                        <label asp-for="WardNumber" class="form-label fw-semibold"></label>
                                        <input asp-for="WardNumber" class="form-control shadow-sm"/>
                                        <span asp-validation-for="WardNumber" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                                <div id="medical" class="tab-pane fade">
                               <h5 class="text-primary mb-3 fw-semibold">Questionnaire</h5>
                                 <hr />
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label asp-for="AteRecently" class="form-label fw-semibold">Did you have something to eat in last 04Hrs?</label><br />
                                        <input type="radio" asp-for="AteRecently" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="AteRecently" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="FillingWell" class="form-label fw-semibold">Are you feeling healthy today?</label><br />
                                        <input type="radio" asp-for="FillingWell" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="FillingWell" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="HadFever" class="form-label fw-semibold">Have you had any fever in last 2 weeks?</label><br />
                                        <input type="radio" asp-for="HadFever" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="HadFever" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="UnderTreatment" class="form-label fw-semibold">Are you under any medical treatment at present?</label><br />
                                        <input type="radio" asp-for="UnderTreatment" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="UnderTreatment" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="RecentSurgery" class="form-label fw-semibold">Have you undergone any surgery in the last 06 months?</label><br />
                                        <input type="radio" asp-for="RecentSurgery" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="RecentSurgery" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="UsedAntibiotics" class="form-label fw-semibold">Have you taken any injectable antibiotics in the last 4 days?</label><br />
                                        <input type="radio" asp-for="UsedAntibiotics" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="UsedAntibiotics" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="BloodTransfusion" class="form-label fw-semibold">Have you received any blood transfusion in the last 06 months?</label><br />
                                        <input type="radio" asp-for="BloodTransfusion" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="BloodTransfusion" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="Alcohol24Hours" class="form-label fw-semibold">Have you had alcohol consumption in last 48Hrs?</label><br />
                                        <input type="radio" asp-for="Alcohol24Hours" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="Alcohol24Hours" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="RiskeyBehavior" class="form-label fw-semibold">Have you ever engaged in any high-risk behavior?</label><br />
                                        <input type="radio" asp-for="RiskeyBehavior" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="RiskeyBehavior" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="HasTattoOrPiercing" class="form-label fw-semibold">Have you had any tattooing,ear piercing, or acupuncture in the last 06 months?</label><br />
                                        <input type="radio" asp-for="HasTattoOrPiercing" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="HasTattoOrPiercing" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="TestedHIVPositive" class="form-label fw-semibold">Have you ever tested HIV positive?</label><br />
                                        <input type="radio" asp-for="TestedHIVPositive" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="TestedHIVPositive" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="HistoryOfJaundice" class="form-label fw-semibold">Have you ever had a history of jaundice or hepatitis?</label><br />
                                        <input type="radio" asp-for="HistoryOfJaundice" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="HistoryOfJaundice" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="PrevRejectedForDonation" class="form-label fw-semibold">Have you ever been rejected previously for blood donation?</label><br />
                                        <input type="radio" asp-for="PrevRejectedForDonation" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="PrevRejectedForDonation" value="false" class="ms-3" />No
                                    </div>
                                </div>
                            </div>
                                <div id="female" class="tab-pane fade">
                                <h5 class="text-primary mb-3 fw-semibold">Women Donor Info</h5>
                                <hr />
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label asp-for="IsPregnant" class="form-label fw-semibold">Are you pregnant?</label><br />
                                        <input type="radio" asp-for="IsPregnant" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="IsPregnant" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="IsBreastFeeding" class="form-label fw-semibold">Are you currently breastfeeding?</label><br />
                                        <input type="radio" asp-for="IsBreastFeeding" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="IsBreastFeeding" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="RecentDeliveryOrAbortion" class="form-label fw-semibold">Have you recently delivered or had an abortion(within last 6months?</label><br />
                                        <input type="radio" asp-for="RecentDeliveryOrAbortion" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="RecentDeliveryOrAbortion" value="false" class="ms-3" />No
                                    </div>
                                    <hr />
                                    <div class="col-md-6">
                                        <label asp-for="IsMenustruating" class="form-label fw-semibold">Are you currently menstruating?</label><br />
                                        <input type="radio" asp-for="IsMenustruating" value="true" class="me-2" />Yes
                                        <input type="radio" asp-for="IsMenustruating" value="false" class="ms-3" />No
                                    </div>
                                </div>
                            </div>
                                <div id="physical" class="tab-pane fade">
                                    <h5 class="text-primary mb-3 fw-semibold">Physical Checkup</h5>
                                    <hr />
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label asp-for="weight" class="form-label fw-semibold"></label>
                                            <input asp-for="weight" class="form-control shadow-sm" />
                                            <span asp-validation-for="weight" class="text-danger small"></span>
                                        </div>
                                        <div class="col-md-6">
                                            <label asp-for="Temperature" class="form-label fw-semibold"></label>
                                            <input asp-for="Temperature" class="form-control shadow-sm" />
                                            <span asp-validation-for="Temperature" class="text-danger small"></span>
                                        </div>
                                        <div class="col-md-6">
                                            <label asp-for="BloodPressure" class="form-label fw-semibold"></label>
                                            <input asp-for="BloodPressure" class="form-control shadow-sm" />
                                            <span asp-validation-for="BloodPressure" class="text-danger small"></span>
                                        </div>
                                        <div class="col-md-6">
                                            <label asp-for="Hemoglobin" class="form-label fw-semibold"></label>
                                            <input asp-for="Hemoglobin" class="form-control shadow-sm" />
                                            <span asp-validation-for="Hemoglobin" class="text-danger small"></span>
                                        </div>
                                        <div class="col-md-12 mt-2">
                                            <div class="form-check">
                                                <input asp-for="FitToDonate" class="form-check-input" />
                                                <label asp-for="FitToDonate" class="form-check-label fw-semibold"></label>
                                            </div>
                                        </div>
                                        <br />
                                        <div class="mt-4 text-center">
                                            <button type="submit" class="btn btn-success shadow-sm me-2">
                                                <i class="bi bi-save2 me-1"></i> Update Donor
                                            </button>
                                            <a asp-action="Index" class="btn btn-secondary shadow-sm">
                                                <i class="bi bi-x-circle me-1"></i> Cancel
                                            </a>
                                        </div>
                                    </div>
                                </div>                       
                                
                        </div>                         
                    </form>                             
                </div>                                                             
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
<script>
      document.addEventListener("DOMContentLoaded", function () {
          const donationTypeRadios = document.querySelectorAll("input[name='DonationType']");
          const genderSelect = document.getElementById("gender");

          const replacementTab = document.querySelector("a[href='#replacement']").closest("li");
          const femaleTab = document.querySelector("a[href='#female']").closest("li");

          function toggleTabs()
          {
              const selectedType = document.querySelector("input[name='DonationType']:checked");
              if(selectedType && selectedType.value === "Replacement")
              {
                 replacementTab.style.display = "block";
              }
              else 
              {
                  replacementTab.style.display = "none";
                  replacementTab.classList.remove("active");
              }
              if(genderSelect.value==="Female")
              {
                 femaleTab.style.display = "block";
              }
              else 
              {
                 femaleTab.style.display = "none";
                 femaleTab.classList.remove("active");
              }
          }
          toggleTabs();
          
          donationTypeRadios.forEach(radio => radio.addEventListener("change", toggleTabs));
          genderSelect.addEventListener("change", toggleTabs);
      });
      document.getElementById("PatientDropdown").addEventListener("change", function () {
            var patientId = this.value;
            if (patientId)
            {
                fetch(`/Patient/GetPatientInfo/${patientId}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById("HospitalName").value = data.hospitalName || "";
                    })
                    .catch(err => console.error(err));
            } 
            else 
            {
                document.getElementById("HospitalName").value = "";
            }
      });
      $(function() 
      {
        $('#DoctorId').select2({
            width: '100%',
            placeholder: "Search or select a doctor"
        });
    });
</script>
}





